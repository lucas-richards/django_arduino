
<!--  detail page -->
{% extends './base.html' %}
{% block content %}
    <div>
        <a class="btn btn-sm btn-primary mb-5" href="{% url 'index' %}">Back to index</a>
    </div>
    <h1>Equipment Detail</h1>
    <div class="m-3">
        <h3>{{ equipment.title }}: </h3>
        <p> {{ equipment.description }}</p>
    </div>
    <h2>Production data</h2>
    <p>{{ error }}</p>
    <form id="dateFilterForm" method="post" action="{% url 'detail' equipment.id %}">
        {% csrf_token %}
        <div class="mb-3">
            <div class="input-group">
                <label for="startDate" class="input-group-text">Start Date</label>
                <input type="date" id="startDate" name="start_date" class="form-control">
                <label for="endDate" class="input-group-text">End Date</label>
                <input type="date" id="endDate" name="end_date" class="form-control">
                <button type="submit" class="btn btn-secondary">Apply</button>
            </div>
        </div>
    </form>
    <canvas id="myChart" style="max-width: 800px;"></canvas>
    <!-- table -->
    <table class="table">
        <thead>
            <tr>
                <th>input description</th>
                <th>quantity</th>
                <th>created time</th>
            </tr>
        </thead>
        <tbody>
            {% for data in production reversed %}
                <tr>
                    <td>{{ data.input_desc }}</td>
                    <td>{{ data.quantity }}</td>
                    <td>{{ data.created_at }}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    
    
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.2.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+" crossorigin="anonymous"></script>
    <script>
        var originalData = {
            labels: {{ created_at|safe }},
            data: {{ quantity }}
        };

        var ctx = document.getElementById("myChart").getContext('2d');
        var myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: originalData.labels,
                datasets: [{
                    label: 'PPM',
                    data: originalData.data,
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 1,
                }]
            },
            options: {
                scales: {
                    xAxes: [{
                        type: 'time',
                        time: {
                            unit: 'hour',
                            displayFormats: {
                                hour: 'YYYY-MM-DD HH:mm'
                            },
                            tooltipFormat: 'YYYY-MM-DD HH:mm'
                        },
                        ticks: {
                            source: 'auto',
                            maxTicksLimit: 6
                        },
                        scaleLabel: {
                            display: true,
                            labelString: 'Date and Time'
                        }
                    }],
                    yAxes: [{
                        ticks: {
                            beginAtZero: true,
                            min: 0,
                        },
                        scaleLabel: {
                            display: true,
                            labelString: 'Values'
                        }
                    }]
                }
            }
        });

        function toggleChart() {
            var startDate = document.getElementById("startDate").value;
            var endDate = document.getElementById("endDate").value;

            // Filter data based on selected date range
            var filteredData = filterData(originalData, startDate, endDate);

            // Update chart data
            myChart.data.labels = filteredData.labels;
            myChart.data.datasets[0].data = filteredData.data;

            // Refresh the chart
            myChart.update();
        }

        function filterData(data, startDate, endDate) {
            var start = new Date(startDate);
            var end = new Date(endDate);

            // Find indices of data within the selected date range
            var startIndex = data.labels.findIndex(label => new Date(label) >= start);
            var endIndex = data.labels.findIndex(label => new Date(label) > end);

            // Slice the data based on the indices
            var filteredLabels = data.labels.slice(startIndex, endIndex);
            var filteredData = data.data.slice(startIndex, endIndex);

            return {
                labels: filteredLabels,
                data: filteredData
            };

        }
    </script>
    
{% endblock %}
```